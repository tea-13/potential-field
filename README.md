# Потенциальные поля: Задача 1 (плоскость) и Задача 2 (решётка)

Набор учебных реализаций метода потенциальных полей:
- **Задача 1** — непрерывная плоскость с круглыми препятствиями: притяжение к цели, отталкивание, движение по антиградиенту, визуализация траектории и поля.
- **Задача 2** — дискретная решётка `width×height`: дискретный потенциал, движение по узлам (8-связность), динамические препятствия (преследование), статичная визуализация и анимация.

## Требования

- Python 3.9+
- Пакеты: `numpy`, `matplotlib`  
  (для сохранения GIF — ещё `pillow`, либо установленный `ffmpeg`)

```bash
pip install numpy matplotlib pillow
```

## Структура (пример)

- `task1_continuous.py` — плоскость (ООП), две карты: «Путь+препятствия» и **тепловая/векторная/потоковая** карта поля.
- `task2_grid.py` — решётка (ООП), жёсткая маска занятости + SDF (клиренс), запрет corner-cutting, динамика, анимация.

> Имена условные — используйте свои файлы. Код ничего не сохраняет сам по себе.

---

## Задача 1 — как получить скриншот

В файле с задачей 1 есть пример вызова визуализации. После отрисовки добавьте сохранение:

```python
import matplotlib.pyplot as plt
# ... ваш вызов viz.plot_two_maps(..., mode="heatmap"/"quiver"/"stream")
plt.savefig("media/task1.png", dpi=180, bbox_inches="tight")
```

![Задача 1 — путь и поле](assets/lab3.png)

**Где крутить параметры**
- `PotentialParams.k_att` — сила притяжения к цели (↓ делает препятствия «значимее»).
- Для каждого препятствия: `eta` (сила отталкивания), `rho0` (радиус влияния).
- Стабильность шага: `PlannerConfig.use_ema`, `beta` (сглаживание), `clip_step` (ограничение шага).
- Отрисовка: `mode="heatmap" | "quiver" | "stream"`, палитра `GridVizConfig.colormap`, клиппирование `robust_clip=None` (чтобы видеть полный диапазон).

---

## Задача 2 — как получить GIF (анимация)

Запустите анимацию и сохраните её в GIF:

```python
from task2_grid import animate_simulation, AnimationConfig
# field, stepper — как в примере в конце файла задачи 2
anim_cfg = AnimationConfig(mode="heat", interval_ms=120, trail=300)
anim = animate_simulation(field, stepper, anim_cfg)

# сохранить GIF (нужен pillow)
anim.save("media/task2.gif", writer="pillow", fps=1000//anim_cfg.interval_ms)
# или просто показать окно:
# import matplotlib.pyplot as plt; plt.show()
```


![Задача 2 — анимация](assets/lab3.1.gif)

**Где крутить параметры**
- `GridPotentialParams.k_att` — притяжение к цели.  
- Слои отталкивания: `RepulsiveConfig(eta, rho0, cell_radius)` — ближний слой «жёсткий», дальний «мягкий».
- Безопасность: жёсткая `occ_mask` (стены), `clearance` (SDF-клиренс) + `GridPlannerConfig.safety_clearance` (подушка безопасности, напр. `0.5` клетки).
- Навигация: `smooth/beta` (EMA), `prefer_grad/tie_bias` (учёт направления −∇U), `allow_diag` (диагонали).
- Динамика: `DynamicObstacle(pos, every, speed_cells, mode="pursue")` — как часто и на сколько клеток движется преследователь.
- Анимация: `AnimationConfig(mode="heat"|"quiver", interval_ms, trail, ...)`  
  В режиме `"quiver"` можно отключить нормировку стрелок (`quiver_normalize=False`) и красить по модулю силы (`quiver_color_by_magnitude=True`).

---

## Частые вопросы

- **«Параметры препятствий не влияют?»**  
  Убедитесь, что препятствие попадает в зону влияния (`phi ≤ rho0`), уменьшите `k_att` или увеличьте `eta/rho0`. Для наглядности включайте карту **только отталкивания** (в задаче 1 — `mode="heatmap"` и проверяйте «холмы» вокруг препятствий; в задаче 2 хорошо видно на общей теплокарте). Отключите робаст-клип `robust_clip=None`, чтобы цвета не «сливались».

- **«Маршрут прошёл через стену?»**  
  Во второй задаче это исключено: используется `occ_mask`, `clearance` и запрет диагонального corner-cutting. При необходимости увеличьте `safety_clearance` (например, `0.5`).

- **«Отчёт требует артефакты?»**  
  Приложите:
  - `media/task1.png` — скриншот карты из задачи 1 (путь + поле).
  - `media/task2.gif` — анимация из задачи 2 (робот + динамические препятствия).

---

## Лицензия

Учебное использование. Добавьте свою лицензию при необходимости.
