# Потенциальные поля: непрерывная плоскость и дискретная решётка

Минимальный README к лабораторной работе по поиску пути методом потенциальных полей (две задачи: непрерывная плоскость и дискретная решётка).

---

## 1. Математическая модель

### 1.1. Непрерывная постановка (плоскость)

Положение робота:  
$$x \in \mathbb{R}^2, \quad x = (x, y)^\top,$$
цель:  
$$x_\text{goal} \in \mathbb{R}^2.$$

Круглое препятствие $i$:  
$$c_i \in \mathbb{R}^2,\quad r_i > 0.$$

Расстояние и зазор до препятствия:  
$$d_i(x) = \|x - c_i\|,\qquad \phi_i(x) = d_i(x) - r_i.$$

**Притягивающий потенциал:**
$$U_\text{att}(x) = \frac{1}{2} k_\text{att} \,\|x - x_\text{goal}\|^2.$$

**Отталкивающий потенциал препятствия $i$:**  

$$U_{\text{rep}, i}(x) =\begin{cases}\dfrac{1}{2} \eta_i \left( \dfrac{1}{\phi_i(x)} - \dfrac{1}{\rho_{0,i}} \right)^2,& 0 < \phi_i(x) \le \rho_{0,i},0, & \phi_i(x) > \rho_{0,i}\end{cases}$$

**Суммарный потенциал:**  
$$U(x) = U_\text{att}(x) + \sum_i U_{\text{rep}, i}(x).$$

**Закон движения (градиентный спуск):**  
$$x_{k+1} = x_k - \alpha_k \nabla U(x_k),$$
где $\alpha_k > 0$ — шаг интегрирования.

---

### 1.2. Дискретная постановка (решётка)

Узлы решётки:  
$$(i, j), \quad i = 0,\dots,W-1,\; j = 0,\dots,H-1.$$

Целевая клетка:
$$(i_g, j_g).$$

**Притягивающий потенциал:**  
$$U_\text{att}(i,j) = \frac{1}{2} k_\text{att}\big[(i - i_g)^2 + (j - j_g)^2\big].$$

Пусть $d(i,j)$ — евклидово расстояние до ближайшего препятствия,  
$$\delta(i,j) = d(i,j) - r_\text{cell}$$
— зазор до «стенки».

**Отталкивающий потенциал:**  

$$U_\text{rep}(i,j) =\begin{cases}\dfrac{1}{2} \eta \left( \dfrac{1}{\delta(i,j)} - \dfrac{1}{\rho_0} \right)^2,& 0 < \delta(i,j) \le \rho_0,0, & \delta(i,j) > \rho_0.\end{cases}$$

**Суммарный потенциал на решётке:**  
$$U(i,j) = U_\text{att}(i,j) + U_\text{rep}(i,j).$$

**Правило выбора следующей клетки:**  
$$(i_{k+1}, j_{k+1}) =
\arg\min_{(p,q)\in \mathcal N(i_k, j_k)} U(p,q),$$  

где $\mathcal N(i_k, j_k)$ — множество разрешённых соседей
(4- или 8-связность, без прохода через углы препятствий и занятые клетки).

Динамические препятствия периодически обновляют карту занятости и расстояний $d(i,j)$; поле $U_\text{rep}$ пересчитывается перед шагом робота.

---

## 2. Реализация

Структура может быть, например, такой:

- **`lab3.py`** — задача 1 (непрерывная плоскость):
  - описание круговых препятствий и цели;
  - вычисление $U(x)$ и $\nabla U(x)$;
  - итерационный шаг $x_{k+1} = x_k - \alpha_k \nabla U(x_k)$;
  - отрисовка траектории и карты поля.

- **`lab3.1.py`** — задача 2 (дискретная решётка):
  - построение $U_\text{att}(i,j)$ и $U_\text{rep}(i,j)$;
  - учёт статических и динамических препятствий;
  - дискретное движение робота по правилу минимума потенциала;
  - статичная визуализация и анимация.

---

## 3. Параметры

Основные параметры, которые настраиваются в коде:

- $k_\text{att}$ — сила притяжения к цели;
- $\eta, \eta_i$ — сила отталкивания препятствий;
- $\rho_0, \rho_{0,i}$ — радиус влияния;
- $r_i, r_\text{cell}$ — радиусы препятствий / ячеек;
- $\alpha_k$ — шаг интегрирования;
- режимы движения по решётке (4/8-связность, запрет corner-cutting и т.п.).

---

## 4. Требования и запуск

Требуется Python **3.9+** и пакеты:

- `numpy`
- `matplotlib`
- для записи GIF — `pillow` или установленный `ffmpeg`.

Установка зависимостей:

```bash
pip install numpy matplotlib pillow
```

Примеры запуска:

```bash
# Непрерывная модель
python lab3.py

# Дискретная решётка
python lab3.1.py
```

---

## 5. Отчёт

Для отчёта обычно прикладываются:

- скриншот поля и траектории для задачи 1;
- анимация движения и препятствий для задачи 2.
